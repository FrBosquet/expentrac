generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Account {
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?  @db.Text
  access_token      String?  @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?  @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  id                 String              @id @default(cuid())
  name               String?
  email              String?             @unique
  emailVerified      DateTime?
  image              String?
  accounts           Account[]
  sessions           Session[]
  loans              Loan[]
  loanShares         LoanShare[]
  subscriptions      Subscription[]
  subscriptionShares SubscriptionShare[]
  providers          UserProvider[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Loan {
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  id         String        @id @default(cuid())
  name       String
  fee        Float
  initial    Float         @default(0)
  startDate  DateTime
  endDate    DateTime
  userId     String
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendorId   String?
  vendor     UserProvider? @relation(name: "LoanVendorRelation", fields: [vendorId], references: [id], onDelete: Cascade)
  platformId String?
  platform   UserProvider? @relation(name: "LoanPlatformRelation", fields: [platformId], references: [id], onDelete: Cascade)
  lenderId   String?
  lender     UserProvider? @relation(name: "LoanLenderRelation", fields: [lenderId], references: [id], onDelete: Cascade)
  shares     LoanShare[]
}

model LoanShare {
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  id        String   @id @default(cuid())
  loanId    String
  loan      Loan     @relation(fields: [loanId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accepted  Boolean?
}

model Subscription {
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  id         String              @id @default(cuid())
  name       String
  fee        Float
  userId     String
  yearly     Boolean             @default(false)
  user       User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendorId   String?
  vendor     UserProvider?       @relation(name: "SubscriptionVendorRelation", fields: [vendorId], references: [id], onDelete: Cascade)
  platformId String?
  platform   UserProvider?       @relation(name: "SubscriptionPlatformRelation", fields: [platformId], references: [id], onDelete: Cascade)
  shares     SubscriptionShare[]
  payday     Int?
}

model SubscriptionShare {
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  id             String       @id @default(cuid())
  subscriptionId String
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  userId         String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  accepted       Boolean?
}

model Provider {
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  id             String         @id @default(cuid())
  name           String         @unique
  users          UserProvider[]
  isFetched      Boolean        @default(false)
  url            String?
  logo           String?
  mainColor      String?
  secondaryColor String?
  rawContent     Json?
}

model UserProvider {
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  id                      String         @id @default(cuid())
  userId                  String
  user                    User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  providerId              String
  provider                Provider       @relation(fields: [providerId], references: [id], onDelete: Cascade)
  loansAsVendor           Loan[]         @relation(name: "LoanVendorRelation")
  loansAsPlatform         Loan[]         @relation(name: "LoanPlatformRelation")
  loansAsLender           Loan[]         @relation(name: "LoanLenderRelation")
  subscriptionsAsVendor   Subscription[] @relation(name: "SubscriptionVendorRelation")
  subscriptionsAsPlatform Subscription[] @relation(name: "SubscriptionPlatformRelation")
}
